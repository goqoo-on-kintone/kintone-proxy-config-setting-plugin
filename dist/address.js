const o=e=>new RegExp("^[0-9]{7}$").test(e),c=async e=>{try{const r=await fetch(`https://zipcloud.ibsnet.co.jp/api/search?zipcode=${e}`),{message:s,results:a}=await r.json();if(s)throw new Error(s);return a}catch(r){throw console.log(r),r}};kintone.events.on(["app.record.create.submit","app.record.edit.submit"],async e=>{try{const r=e.record,s=r.zipcode.value;if(!o(s))return r.zipcode.error="郵便番号はハイフンなしの7桁の数字で指定してください。",e;const t=await c(s);return r.address1.value=t?.[0]?.address1||"",r.address2.value=t?.[0]?.address2||"",r.address3.value=t?.[0]?.address3||"",e}catch(r){return e.error=r.message,e}});
